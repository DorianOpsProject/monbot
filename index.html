<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini App Catalogue</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode:'class',
    theme: {
      extend: {
        colors: {
          bg0:'#05070D',
          bg1:'#0B1020',
          accent:'#FFD400',
          accent2:'#FFB800',
          text:'rgba(250,253,255,.96)',
          muted:'rgba(250,253,255,.66)',
          muted2:'rgba(250,253,255,.48)',
          good:'#2EE59D',
          bad:'#FF4D4D',
        },
        borderRadius:{
          xl2:'18px',
          xl3:'24px',
          xl4:'28px'
        },
        fontFamily:{
          ui:['ui-sans-serif','system-ui','-apple-system','"SF Pro Display"','"SF Pro Text"','Segoe UI','Roboto','Helvetica','Arial','"Apple Color Emoji"','"Segoe UI Emoji"']
        }
      }
    }
  }
</script>
</head>
<body class="min-h-screen font-ui bg-bg0 text-text px-4 py-4">

<!-- HEADER -->
<header class="mb-4">
  <h1 class="text-2xl font-black">Catalogue Mini App</h1>
  <input id="search" type="search" placeholder="Recherche produit/provenance"
         class="mt-2 w-full rounded-xl2 border border-white/10 bg-bg1 px-3 py-2 text-text outline-none"/>
</header>

<!-- PRODUITS -->
<section id="catalogue" class="grid gap-4"></section>

<!-- PANIER FIXED BOTTOM -->
<div id="cartBar" class="fixed bottom-0 left-0 right-0 bg-bg1 border-t border-white/10 p-3 flex items-center justify-between shadow-lg rounded-t-xl4">
  <div>
    <div class="font-black">Panier</div>
    <div id="cartSummary" class="text-sm text-muted">Aucun produit</div>
  </div>
  <div class="flex gap-2">
    <button id="clearCart" class="px-3 py-2 rounded-xl2 border border-white/10 bg-white/5 text-text font-black">Vider</button>
    <button id="copyCart" class="px-3 py-2 rounded-xl2 border border-white/10 bg-white/5 text-text font-black">Copier</button>
  </div>
</div>

<script>
/* ==============================
   DONN√âES PRODUITS
   ============================== */
const PRODUCTS = [
  {id:"P01",name:"Mousseux",origin:"üá≤üá¶",price:10},
  {id:"P02",name:"Static",origin:"üá≤üá¶",price:12},
  {id:"P03",name:"Frozen",origin:"üá≤üá¶",price:15},
  {id:"P04",name:"Beldia",origin:"üá≤üá¶",price:12},
  {id:"P05",name:"Produit 05",origin:"üá≥üá±",price:8},
  {id:"P06",name:"Produit 06",origin:"üá≥üá±",price:11},
  {id:"P07",name:"Cali Plates",origin:"üá∫üá∏",price:20},
  {id:"P08",name:"Cali NL",origin:"üá≥üá±",price:10},
  {id:"P09",name:"Cali US",origin:"üá∫üá∏",price:22},
  {id:"P10",name:"Produit 10",origin:"üá∫üá∏",price:18},
  {id:"P11",name:"Cali Canadienne",origin:"üá®üá¶",price:12},
];

/* ==============================
   STATE
   ============================== */
let state = {
  cart: loadCart(),
  query: ""
};

/* ==============================
   HELPERS
   ============================== */
function loadCart(){
  try{
    const c=JSON.parse(localStorage.getItem('mini_cart'));
    return c&&typeof c==='object'?c:{};
  }catch(e){return {};}
}
function saveCart(){
  localStorage.setItem('mini_cart',JSON.stringify(state.cart));
}
function money(n){return Number(n||0).toFixed(2)+' ‚Ç¨';}

/* ==============================
   RENDER CATALOGUE
   ============================== */
const catalogueEl = document.getElementById('catalogue');
function renderCatalogue(){
  const q = state.query.toLowerCase();
  catalogueEl.innerHTML = '';
  const filtered = PRODUCTS.filter(p=>p.name.toLowerCase().includes(q)||p.origin.toLowerCase().includes(q));
  if(filtered.length === 0){
    catalogueEl.innerHTML='<div class="text-muted text-center">Aucun produit trouv√©.</div>';
    return;
  }
  filtered.forEach(p => {
    const weight = state.cart[p.id]?.weight || 1;
    const card = document.createElement('div');
    card.className='bg-bg1 border border-white/10 rounded-xl3 p-3 flex justify-between items-center';
    card.innerHTML = `
      <div>
        <div class="font-black text-lg">${p.name}</div>
        <div class="text-sm text-muted">${p.origin}</div>
        <div class="text-sm font-black mt-1">${money(p.price)} / 100g</div>
      </div>
      <div class="flex flex-col items-end gap-2">
        <div class="flex gap-1 items-center">
          <button data-act="dec" data-id="${p.id}" class="px-2 py-1 rounded border border-white/10 bg-white/5 text-text font-black">‚àí</button>
          <input type="number" min="1" max="1000" step="10" value="${weight}" data-id="${p.id}" class="w-20 text-black rounded px-1 py-0.5 text-center"/>
          <button data-act="inc" data-id="${p.id}" class="px-2 py-1 rounded border border-white/10 bg-white/5 text-text font-black">+</button>
        </div>
        <button data-act="add" data-id="${p.id}" class="mt-1 px-3 py-1 rounded-xl2 border border-white/10 bg-accent text-black font-black w-full">
          Ajouter au panier
        </button>
      </div>
    `;
    catalogueEl.appendChild(card);
  });
}

/* ==============================
   HANDLE BUTTONS
   ============================== */
catalogueEl.addEventListener('click', e => {
  const btn = e.target.closest('button');
  if(!btn) return;
  const act = btn.dataset.act, id = btn.dataset.id;
  if(!id) return;

  const input = catalogueEl.querySelector(`input[data-id="${id}"]`);
  let weight = input ? parseInt(input.value) : 1;
  if(act === 'inc') weight += 10;
  if(act === 'dec') weight -= 10;
  weight = Math.max(1, Math.min(1000, weight));
  if(input) input.value = weight;

  if(act === 'add') state.cart[id] = {weight};
  saveCart();
  renderCart();
});

/* ==============================
   HANDLE INPUT CHANGE
   ============================== */
catalogueEl.addEventListener('input', e=>{
  const input = e.target.closest('input');
  if(!input) return;
  const id = input.dataset.id;
  let weight = parseInt(input.value) || 1;
  weight = Math.max(1, Math.min(1000, weight));
  input.value = weight;
  state.cart[id] = {weight};
  saveCart();
  renderCart();
});

/* ==============================
   SEARCH
   ============================== */
document.getElementById('search').addEventListener('input', e=>{
  state.query = e.target.value;
  renderCatalogue();
});

/* ==============================
   RENDER PANIER
   ============================== */
const cartSummary = document.getElementById('cartSummary');
function renderCart(){
  const items = Object.entries(state.cart);
  if(items.length === 0){
    cartSummary.textContent = 'Aucun produit';
    return;
  }
  let total = 0;
  const lines = [];
  items.forEach(([id, data])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(p){
      const price = p.price * (data.weight/100);
      total += price;
      lines.push(`${p.origin} ${p.name} √ó${data.weight}g = ${money(price)}`);
    }
  });
  cartSummary.textContent = `${items.length} produit(s) ‚Ä¢ Total indicatif ${money(total)}`;
  cartSummary.dataset.lines = lines.join('\n');
}

/* ==============================
   CLEAR / COPY CART
   ============================== */
document.getElementById('clearCart').addEventListener('click', ()=>{
  state.cart = {};
  saveCart();
  renderCatalogue();
  renderCart();
});

document.getElementById('copyCart').addEventListener('click', ()=>{
  const text = cartSummary.dataset.lines || 'Panier vide';
  navigator.clipboard.writeText(text).then(()=>alert('Panier copi√© !'));
});

/* ==============================
   INITIALIZE
   ============================== */
renderCatalogue();
renderCart();
</script>

</body>
</html>
