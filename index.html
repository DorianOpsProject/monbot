<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catalogue Produits</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

<!-- Header -->
<header class="flex justify-between items-center p-4 bg-gray-800 shadow-md">
  <h1 class="text-2xl font-bold">Mon Marché</h1>
  <div class="relative">
    <button id="cartBtn" class="flex items-center gap-2 px-4 py-2 bg-accent rounded-xl hover:bg-yellow-400 transition">
      Panier
      <span id="cartBadge" class="ml-1 px-2 py-1 bg-black text-white rounded-full text-sm">0</span>
    </button>
  </div>
</header>

<!-- Catalogue -->
<main class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="catalogue">
  <!-- Les cartes seront générées par JS -->
</main>

<!-- Modal Panier -->
<div id="cartModal" class="fixed inset-0 bg-black/50 hidden justify-center items-center z-50">
  <div class="bg-gray-800 rounded-xl p-6 w-11/12 max-w-md">
    <h2 class="text-xl font-bold mb-4">Votre Panier</h2>
    <div id="cartItems" class="space-y-4 max-h-64 overflow-y-auto"></div>
    <div class="mt-4 flex justify-between font-bold text-lg">
      <span>Total :</span>
      <span id="cartTotal">0 €</span>
    </div>
    <button onclick="toggleCart(false)" class="mt-4 w-full py-2 bg-accent rounded-xl hover:bg-yellow-400 transition">Fermer</button>
  </div>
</div>

<script>
const products = [
  {id:1, name:"Tomates", pricePer100g:0.5, image:"https://via.placeholder.com/150"},
  {id:2, name:"Pommes", pricePer100g:0.8, image:"https://via.placeholder.com/150"},
  {id:3, name:"Fromage", pricePer100g:1.2, image:"https://via.placeholder.com/150"}
];

let cart = [];

// Génération du catalogue
const catalogue = document.getElementById('catalogue');

products.forEach(p => {
  const card = document.createElement('div');
  card.className = "bg-gray-700 rounded-xl p-4 flex flex-col items-center hover:shadow-lg transition";

  card.innerHTML = `
    <img src="${p.image}" alt="${p.name}" class="w-32 h-32 object-cover rounded-xl mb-3">
    <h3 class="font-bold text-lg mb-1">${p.name}</h3>
    <p class="mb-2">${p.pricePer100g} € / 100g</p>
    <div class="flex items-center gap-2 mb-3">
      <input type="number" min="50" max="1000" step="50" value="100" class="w-20 text-black p-1 rounded" id="weight-${p.id}"> g
    </div>
    <button class="bg-accent text-black px-4 py-2 rounded-xl hover:bg-yellow-400 transition" onclick="addToCart(${p.id})">Ajouter</button>
  `;
  catalogue.appendChild(card);
});

// Ajouter au panier
function addToCart(id) {
  const product = products.find(p => p.id === id);
  const weight = parseInt(document.getElementById(`weight-${id}`).value);

  const existing = cart.find(c => c.id === id);
  if(existing) {
    existing.weight += weight;
  } else {
    cart.push({...product, weight});
  }
  updateCartUI();
}

// Mettre à jour l'UI du panier
function updateCartUI() {
  const cartBadge = document.getElementById('cartBadge');
  cartBadge.textContent = cart.reduce((sum,c)=> sum+1,0);

  const cartItems = document.getElementById('cartItems');
  cartItems.innerHTML = "";
  let total = 0;

  cart.forEach(item => {
    const itemTotal = (item.pricePer100g * item.weight / 100).toFixed(2);
    total += parseFloat(itemTotal);

    const div = document.createElement('div');
    div.className = "flex justify-between items-center bg-gray-600 p-2 rounded-xl";
    div.innerHTML = `
      <div>
        <p class="font-bold">${item.name}</p>
        <p class="text-sm">${item.weight}g - ${itemTotal} €</p>
      </div>
      <div class="flex items-center gap-1">
        <button onclick="changeWeight(${item.id}, -50)" class="px-2 py-1 bg-gray-500 rounded hover:bg-gray-400">-</button>
        <button onclick="changeWeight(${item.id}, 50)" class="px-2 py-1 bg-gray-500 rounded hover:bg-gray-400">+</button>
      </div>
    `;
    cartItems.appendChild(div);
  });

  document.getElementById('cartTotal').textContent = total.toFixed(2) + " €";
}

// Modifier le poids dans le panier
function changeWeight(id, delta) {
  const item = cart.find(c => c.id===id);
  if(!item) return;
  item.weight += delta;
  if(item.weight < 50) item.weight = 50;
  updateCartUI();
}

// Toggle Modal Panier
function toggleCart(show) {
  document.getElementById('cartModal').classList.toggle('hidden', !show);
}

// Ouvrir le panier
document.getElementById('cartBtn').addEventListener('click', () => toggleCart(true));
</script>
</body>
</html>
