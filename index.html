<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini App Catalogue Premium</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        colors: {
          bg0: '#05070D',
          bg1: '#0B1020',
          accent: '#FFD400',
          accent2: '#FFB800',
          text: 'rgba(250,253,255,.96)',
          muted: 'rgba(250,253,255,.66)',
          muted2: 'rgba(250,253,255,.48)',
          good: '#2EE59D',
          bad: '#FF4D4D',
        },
        borderRadius: {
          xl2: '18px',
          xl3: '24px',
          xl4: '28px'
        },
        fontFamily: {
          ui: ['ui-sans-serif','system-ui','-apple-system','"SF Pro Display"','"SF Pro Text"','Segoe UI','Roboto','Helvetica','Arial','"Apple Color Emoji"','"Segoe UI Emoji"']
        }
      }
    }
  }
</script>
</head>
<body class="min-h-screen font-ui bg-bg0 text-text px-4 py-4">

<!-- HEADER -->
<header class="mb-6">
  <h1 class="text-3xl font-extrabold mb-2">Catalogue Mini App</h1>
  <input id="search" type="search" placeholder="Recherche produit/provenance"
         class="mt-2 w-full rounded-xl2 border border-white/10 bg-bg1 px-4 py-2 text-text outline-none placeholder:text-muted"/>
</header>

<!-- CATALOGUE -->
<section id="catalogue" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></section>

<!-- DRAWER PANIER -->
<div id="drawerBackdrop" class="fixed inset-0 bg-black/50 hidden"></div>
<div id="drawer" class="fixed right-0 top-0 h-full w-80 bg-bg1 shadow-xl transform translate-x-full transition-transform duration-300 flex flex-col">
  <div class="flex justify-between items-center p-4 border-b border-white/10">
    <h2 class="font-black text-xl">Panier</h2>
    <button id="closeDrawer" class="text-text font-black text-lg">&times;</button>
  </div>
  <div id="drawerContent" class="p-4 flex-1 overflow-y-auto space-y-3"></div>
  <div class="p-4 border-t border-white/10">
    <div id="drawerTotal" class="font-black text-lg mb-3">Total : 0 ‚Ç¨</div>
    <button id="clearCart" class="w-full mb-2 px-4 py-2 rounded-xl2 border border-white/10 bg-white/5 text-text font-black">Vider le panier</button>
    <button id="copyCart" class="w-full px-4 py-2 rounded-xl2 border border-white/10 bg-accent text-black font-black">Copier le panier</button>
  </div>
</div>

<!-- OUVRIR LE DRAWER -->
<button id="openDrawer" class="fixed bottom-6 right-6 bg-accent text-black px-4 py-3 rounded-xl4 font-black shadow-lg">Panier</button>

<script>
/* ==============================
   DONN√âES PRODUITS
   ============================== */
const PRODUCTS = [
  {id:"P01",name:"Mousseux",origin:"üá≤üá¶",price:10},
  {id:"P02",name:"Static",origin:"üá≤üá¶",price:12},
  {id:"P03",name:"Frozen",origin:"üá≤üá¶",price:15},
  {id:"P04",name:"Beldia",origin:"üá≤üá¶",price:12},
  {id:"P05",name:"Produit 05",origin:"üá≥üá±",price:8},
  {id:"P06",name:"Produit 06",origin:"üá≥üá±",price:11},
  {id:"P07",name:"Cali Plates",origin:"üá∫üá∏",price:20},
  {id:"P08",name:"Cali NL",origin:"üá≥üá±",price:10},
  {id:"P09",name:"Cali US",origin:"üá∫üá∏",price:22},
  {id:"P10",name:"Produit 10",origin:"üá∫üá∏",price:18},
  {id:"P11",name:"Cali Canadienne",origin:"üá®üá¶",price:12},
];

/* ==============================
   STATE
   ============================== */
let state = {
  cart: loadCart(),
  query: ""
};

/* ==============================
   HELPERS
   ============================== */
function loadCart(){
  try{
    const c=JSON.parse(localStorage.getItem('mini_cart'));
    return c&&typeof c==='object'?c:{};
  }catch(e){return {};}
}
function saveCart(){
  localStorage.setItem('mini_cart',JSON.stringify(state.cart));
}
function money(n){return Number(n||0).toFixed(2)+' ‚Ç¨';}

/* ==============================
   RENDER CATALOGUE
   ============================== */
const catalogueEl = document.getElementById('catalogue');
function renderCatalogue(){
  const q = state.query.toLowerCase();
  catalogueEl.innerHTML = '';
  const filtered = PRODUCTS.filter(p=>p.name.toLowerCase().includes(q)||p.origin.toLowerCase().includes(q));
  if(filtered.length===0){
    catalogueEl.innerHTML='<div class="text-muted text-center col-span-full">Aucun produit trouv√©.</div>';
    return;
  }

  filtered.forEach(p=>{
    const qty = state.cart[p.id]?.qty || 0;
    const grams = state.cart[p.id]?.grams || 1;

    const card = document.createElement('div');
    card.className='bg-bg1 border border-white/10 rounded-xl3 p-4 flex flex-col justify-between shadow-sm';
    card.innerHTML=`
      <div class="flex justify-between items-start mb-3">
        <div>
          <div class="font-black text-lg">${p.name}</div>
          <div class="text-sm text-muted">${p.origin}</div>
          <div class="text-sm font-black mt-1">${money(p.price)} / unit√©</div>
        </div>
        <div class="text-sm font-black text-muted">${qty>0?qty+'√ó':''}</div>
      </div>

      <!-- SLIDER GRAMMES -->
      <div class="mb-3">
        <label for="slider-${p.id}" class="text-sm text-muted font-black">Grammes : <span id="sliderVal-${p.id}" class="text-accent">${grams}</span>g</label>
        <input id="slider-${p.id}" type="range" min="1" max="10" value="${grams}" class="w-full h-2 bg-white/10 rounded-xl2 accent-accent">
      </div>

      <button data-act="add" data-id="${p.id}" class="mt-2 w-full px-3 py-2 rounded-xl2 border border-white/10 bg-accent text-black font-black">Ajouter</button>
    `;
    catalogueEl.appendChild(card);

    // Slider interaction
    const slider = card.querySelector(`#slider-${p.id}`);
    const sliderVal = card.querySelector(`#sliderVal-${p.id}`);
    slider.addEventListener('input', e => {
      sliderVal.textContent = e.target.value;
    });
  });
}

/* ==============================
   HANDLE ACTIONS
   ============================== */
catalogueEl.addEventListener('click', e=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  const act = btn.dataset.act;
  const id = btn.dataset.id;
  if(!id) return;

  const slider = document.getElementById(`slider-${id}`);
  const grams = Number(slider?.value || 1);

  if(act==='add'){
    if(state.cart[id]){
      state.cart[id].qty += 1;
      state.cart[id].grams = grams;
    } else {
      state.cart[id] = {qty:1, grams};
    }
  }
  saveCart();
  renderCatalogue();
  renderDrawer();
});

/* ==============================
   SEARCH
   ============================== */
document.getElementById('search').addEventListener('input',e=>{
  state.query=e.target.value;
  renderCatalogue();
});

/* ==============================
   RENDER DRAWER
   ============================== */
const drawer = document.getElementById('drawer');
const drawerBackdrop = document.getElementById('drawerBackdrop');
const drawerContent = document.getElementById('drawerContent');
const drawerTotal = document.getElementById('drawerTotal');

function renderDrawer(){
  drawerContent.innerHTML='';
  const items = Object.entries(state.cart);
  if(items.length===0){
    drawerContent.innerHTML='<div class="text-muted text-center">Panier vide</div>';
    drawerTotal.textContent = 'Total : 0 ‚Ç¨';
    return;
  }

  let total = 0;
  items.forEach(([id, {qty, grams}])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    const lineTotal = p.price * qty * grams;
    total += lineTotal;

    const itemEl = document.createElement('div');
    itemEl.className='flex justify-between items-center bg-bg0/20 p-3 rounded-xl2';
    itemEl.innerHTML=`
      <div>
        <div class="font-black">${p.name}</div>
        <div class="text-sm text-muted">${grams}g √ó ${qty}</div>
      </div>
      <div class="font-black">${money(lineTotal)}</div>
    `;
    drawerContent.appendChild(itemEl);
  });

  drawerTotal.textContent = `Total : ${money(total)}`;
}

/* ==============================
   DRAWER TOGGLE
   ============================== */
document.getElementById('openDrawer').addEventListener('click', ()=>{
  drawer.classList.remove('translate-x-full');
  drawerBackdrop.classList.remove('hidden');
});
document.getElementById('closeDrawer').addEventListener('click', closeDrawer);
drawerBackdrop.addEventListener('click', closeDrawer);

function closeDrawer(){
  drawer.classList.add('translate-x-full');
  drawerBackdrop.classList.add('hidden');
}

/* ==============================
   CLEAR / COPY
   ============================== */
document.getElementById('clearCart').addEventListener('click',()=>{
  state.cart={};
  saveCart();
  renderCatalogue();
  renderDrawer();
});

document.getElementById('copyCart').addEventListener('click',()=>{
  const lines = Object.entries(state.cart).map(([id,{qty,grams}])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    return `${p.name} ${grams}g √ó${qty} = ${money(p.price*qty*grams)}`;
  }).join('\n');
  navigator.clipboard.writeText(lines || 'Panier vide').then(()=>alert('Panier copi√© !'));
});

/* ==============================
   INITIALIZE
   ============================== */
renderCatalogue();
renderDrawer();
</script>

</body>
</html>
