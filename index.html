<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini App ‚Äî Commande au gramme</title>

<!-- ========================================================= -->
<!-- TAILWIND CDN -->
<!-- ========================================================= -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        bg0: '#070916',
        bg1: '#0C1024',
        glass: 'rgba(255,255,255,0.05)',
        stroke: 'rgba(255,255,255,0.08)',
        text: 'rgba(240,244,255,0.95)',
        muted: 'rgba(240,244,255,0.60)',
        accent: '#6EE7FF',
        accent2: '#8B5CF6',
        danger: '#FB7185',
        ok: '#34D399'
      },
      borderRadius: {
        xl3: '22px'
      }
    }
  }
}
</script>

<!-- ========================================================= -->
<!-- STYLES CUSTOM -->
<!-- ========================================================= -->
<style>
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}
.fade-up {
  animation: fadeUp .25s ease-out both;
}
</style>
</head>

<body class="min-h-screen text-text
bg-[radial-gradient(900px_600px_at_20%_-10%,rgba(139,92,246,.18),transparent_60%),radial-gradient(900px_600px_at_90%_10%,rgba(110,231,255,.18),transparent_55%),linear-gradient(180deg,#070916,#0C1024)]">

<!-- ========================================================= -->
<!-- APP CONTAINER -->
<!-- ========================================================= -->
<div class="max-w-[980px] mx-auto px-4 pb-40">

<!-- ========================================================= -->
<!-- HEADER -->
<!-- ========================================================= -->
<header class="sticky top-0 z-30 backdrop-blur-xl border-b border-white/10 py-4">
  <h1 class="text-xl font-black">Catalogue ‚Äî Vente au gramme</h1>
  <p class="text-sm text-muted">Mini app m√©tier ‚Ä¢ Commande pr√©cise</p>

  <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
    <input id="searchInput" placeholder="Rechercher un produit"
      class="bg-glass border border-white/10 rounded-xl3 px-4 py-3">

    <select id="originFilter"
      class="bg-glass border border-white/10 rounded-xl3 px-4 py-3">
      <option value="all">Toutes provenances</option>
    </select>

    <select id="sortSelect"
      class="bg-glass border border-white/10 rounded-xl3 px-4 py-3">
      <option value="name">Tri : Nom</option>
      <option value="priceAsc">Prix /g croissant</option>
      <option value="priceDesc">Prix /g d√©croissant</option>
    </select>
  </div>
</header>

<!-- ========================================================= -->
<!-- PRODUCT LIST -->
<!-- ========================================================= -->
<main id="productList" class="mt-6 grid gap-4"></main>

</div>

<!-- ========================================================= -->
<!-- CART -->
<!-- ========================================================= -->
<div id="cartPanel"
class="fixed bottom-0 left-0 right-0 bg-[#0B0F1E]/95 backdrop-blur-xl border-t border-white/10 p-4 hidden">

  <h2 class="font-black text-lg">Commande</h2>

  <div id="cartItems" class="mt-3 space-y-3 text-sm"></div>

  <div class="mt-4 flex justify-between text-base">
    <span>Total</span>
    <strong id="cartTotal">0 ‚Ç¨</strong>
  </div>

  <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
    <input id="clientName" placeholder="Nom client"
      class="bg-glass border border-white/10 rounded-xl3 px-3 py-2">
    <input id="clientContact" placeholder="Contact"
      class="bg-glass border border-white/10 rounded-xl3 px-3 py-2">
    <input id="clientRef" placeholder="R√©f√©rence interne"
      class="bg-glass border border-white/10 rounded-xl3 px-3 py-2">
  </div>

  <textarea id="clientNote"
    placeholder="Note compl√©mentaire"
    class="mt-3 w-full bg-glass border border-white/10 rounded-xl3 px-3 py-2"></textarea>

  <div class="mt-4 grid grid-cols-2 gap-3">
    <button id="exportTelegram"
      class="bg-gradient-to-br from-accent to-accent2 text-black font-black py-3 rounded-xl3">
      Envoyer Telegram
    </button>
    <button id="clearCart"
      class="bg-white/10 py-3 rounded-xl3">
      Vider
    </button>
  </div>
</div>

<script>
/* ============================================================
   CONFIG
============================================================ */
const TELEGRAM_USERNAME = "TON_USERNAME";

/* ============================================================
   PRODUITS (NO IMAGE / M√âTIER)
============================================================ */
const PRODUCTS = [
  { id: 1,  name: "R√©sine Alpha",    origin: "Maroc",   pricePerGram: 7.5 },
  { id: 2,  name: "Fleur Delta",     origin: "Espagne", pricePerGram: 9.2 },
  { id: 3,  name: "Concentr√© Zeta",  origin: "Suisse",  pricePerGram: 14.0 },
  { id: 4,  name: "Extract Omega",   origin: "Canada",  pricePerGram: 18.5 },
  { id: 5,  name: "Fleur Sigma",     origin: "France",  pricePerGram: 8.8 }
];

/* ============================================================
   STATE GLOBAL
============================================================ */
const state = {
  products: PRODUCTS,
  cart: JSON.parse(localStorage.getItem("cart") || "{}"),
  search: "",
  origin: "all",
  sort: "name"
};

/* ============================================================
   HELPERS
============================================================ */
const $ = id => document.getElementById(id);

function saveCart() {
  localStorage.setItem("cart", JSON.stringify(state.cart));
}

/* ============================================================
   INITIALISATION PROVENANCES
============================================================ */
(function initOrigins(){
  const origins = [...new Set(PRODUCTS.map(p => p.origin))];
  origins.forEach(o=>{
    const opt = document.createElement("option");
    opt.value = o;
    opt.textContent = o;
    $("originFilter").appendChild(opt);
  });
})();

/* ============================================================
   RENDER PRODUITS
============================================================ */
function renderProducts() {
  const list = $("productList");
  list.innerHTML = "";

  let items = [...state.products];

  if (state.search) {
    items = items.filter(p =>
      p.name.toLowerCase().includes(state.search)
    );
  }

  if (state.origin !== "all") {
    items = items.filter(p => p.origin === state.origin);
  }

  if (state.sort === "priceAsc") {
    items.sort((a,b)=>a.pricePerGram-b.pricePerGram);
  } else if (state.sort === "priceDesc") {
    items.sort((a,b)=>b.pricePerGram-a.pricePerGram);
  } else {
    items.sort((a,b)=>a.name.localeCompare(b.name));
  }

  items.forEach(p=>{
    const row = document.createElement("div");
    row.className = "bg-glass border border-white/10 rounded-xl3 p-4 fade-up";

    row.innerHTML = `
      <div class="flex justify-between">
        <div>
          <h3 class="font-black">${p.name}</h3>
          <p class="text-sm text-muted">${p.origin}</p>
        </div>
        <div class="text-right">
          <p class="font-bold">${p.pricePerGram.toFixed(2)} ‚Ç¨/g</p>
        </div>
      </div>

      <div class="mt-4 grid grid-cols-3 gap-2">
        <input type="number" min="0" step="0.1"
          placeholder="Grammes"
          class="col-span-2 bg-glass border border-white/10 rounded-xl3 px-3 py-2"
          id="g-${p.id}">
        <button
          class="bg-white/10 rounded-xl3"
          onclick="addToCart(${p.id})">
          Ajouter
        </button>
      </div>
    `;
    list.appendChild(row);
  });
}

/* ============================================================
   PANIER
============================================================ */
function addToCart(productId) {
  const input = document.getElementById(`g-${productId}`);
  const grams = parseFloat(input.value);
  if (!grams || grams <= 0) return;

  state.cart[productId] = (state.cart[productId] || 0) + grams;
  input.value = "";
  saveCart();
  renderCart();
}

function removeFromCart(productId) {
  delete state.cart[productId];
  saveCart();
  renderCart();
}

function renderCart() {
  const box = $("cartItems");
  box.innerHTML = "";
  let total = 0;

  Object.keys(state.cart).forEach(id=>{
    const p = state.products.find(x=>x.id==id);
    const grams = state.cart[id];
    const price = grams * p.pricePerGram;
    total += price;

    const line = document.createElement("div");
    line.className = "flex justify-between items-center";

    line.innerHTML = `
      <div>
        <strong>${p.name}</strong>
        <p class="text-xs text-muted">${grams.toFixed(2)} g √ó ${p.pricePerGram} ‚Ç¨/g</p>
      </div>
      <div class="text-right">
        <p>${price.toFixed(2)} ‚Ç¨</p>
        <button class="text-danger text-xs" onclick="removeFromCart(${id})">Supprimer</button>
      </div>
    `;
    box.appendChild(line);
  });

  $("cartTotal").textContent = total.toFixed(2) + " ‚Ç¨";
  $("cartPanel").classList.toggle("hidden", total === 0);
}

/* ============================================================
   EXPORT TELEGRAM
============================================================ */
$("exportTelegram").onclick = ()=>{
  let msg = "üßæ COMMANDE\n\n";
  Object.keys(state.cart).forEach(id=>{
    const p = PRODUCTS.find(x=>x.id==id);
    const g = state.cart[id];
    msg += `‚Ä¢ ${p.name} (${p.origin})\n`;
    msg += `  ${g.toFixed(2)} g √ó ${p.pricePerGram} ‚Ç¨/g\n`;
  });

  msg += "\nClient : " + $("clientName").value;
  msg += "\nContact : " + $("clientContact").value;
  msg += "\nRef : " + $("clientRef").value;
  msg += "\nNote : " + $("clientNote").value;

  window.open(`https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(msg)}`);
};

/* ============================================================
   EVENTS
============================================================ */
$("searchInput").oninput = e => {
  state.search = e.target.value.toLowerCase();
  renderProducts();
};
$("originFilter").onchange = e => {
  state.origin = e.target.value;
  renderProducts();
};
$("sortSelect").onchange = e => {
  state.sort = e.target.value;
  renderProducts();
};
$("clearCart").onclick = ()=>{
  state.cart = {};
  saveCart();
  renderCart();
};

/* ============================================================
   INIT
============================================================ */
renderProducts();
renderCart();
</script>
</body>
</html>
