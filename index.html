<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini App Catalogue</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        colors: {
          bg0: '#05070D',
          bg1: '#0B1020',
          accent: '#FFD400',
          accent2: '#FFB800',
          text: 'rgba(250,253,255,.96)',
          muted: 'rgba(250,253,255,.66)',
          muted2: 'rgba(250,253,255,.48)',
          good: '#2EE59D',
          bad: '#FF4D4D',
        },
        borderRadius: {
          xl2: '18px',
          xl3: '24px',
          xl4: '28px'
        },
        fontFamily: {
          ui: ['ui-sans-serif','system-ui','-apple-system','"SF Pro Display"','"SF Pro Text"','Segoe UI','Roboto','Helvetica','Arial','"Apple Color Emoji"','"Segoe UI Emoji"']
        }
      }
    }
  }
</script>
</head>
<body class="min-h-screen font-ui bg-bg0 text-text px-4 py-4 overflow-x-hidden">

<!-- HEADER -->
<header class="mb-4">
  <h1 class="text-2xl font-black">Catalogue Mini App</h1>
  <input id="search" type="search" placeholder="Recherche produit/provenance"
         class="mt-2 w-full rounded-xl2 border border-white/10 bg-bg1 px-3 py-2 text-text outline-none"/>
</header>

<!-- CATALOGUE -->
<section id="catalogue" class="grid gap-3"></section>

<!-- DRAWER PANIER -->
<div id="cartDrawer" class="fixed top-0 right-[-100%] w-80 h-full bg-bg1 border-l border-white/10 shadow-lg transition-all duration-300 z-50 flex flex-col">
  <div class="p-4 border-b border-white/10 flex justify-between items-center">
    <div class="font-black text-lg">Panier</div>
    <button id="closeCart" class="text-accent font-black">âœ•</button>
  </div>
  <div id="cartItems" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
  <div class="p-4 border-t border-white/10">
    <div class="flex justify-between font-black mb-2">
      <span>Total</span>
      <span id="cartTotal">0 â‚¬</span>
    </div>
    <button id="copyCart" class="w-full py-2 rounded-xl2 bg-accent text-black font-black mb-2">Copier le panier</button>
    <button id="clearCart" class="w-full py-2 rounded-xl2 border border-white/10 bg-white/5 text-text font-black">Vider le panier</button>
  </div>
</div>

<!-- BUTTON TO OPEN CART -->
<button id="openCart" class="fixed bottom-4 right-4 bg-accent px-4 py-3 rounded-full font-black shadow-lg z-40">Panier</button>

<script>
/* ==============================
   DONNÃ‰ES PRODUITS
   ============================== */
const PRODUCTS = [
  {id:"P01",name:"Mousseux",origin:"ðŸ‡²ðŸ‡¦",price:10},
  {id:"P02",name:"Static",origin:"ðŸ‡²ðŸ‡¦",price:12},
  {id:"P03",name:"Frozen",origin:"ðŸ‡²ðŸ‡¦",price:15},
  {id:"P04",name:"Beldia",origin:"ðŸ‡²ðŸ‡¦",price:12},
  {id:"P05",name:"Produit 05",origin:"ðŸ‡³ðŸ‡±",price:8},
  {id:"P06",name:"Produit 06",origin:"ðŸ‡³ðŸ‡±",price:11},
  {id:"P07",name:"Cali Plates",origin:"ðŸ‡ºðŸ‡¸",price:20},
  {id:"P08",name:"Cali NL",origin:"ðŸ‡³ðŸ‡±",price:10},
  {id:"P09",name:"Cali US",origin:"ðŸ‡ºðŸ‡¸",price:22},
  {id:"P10",name:"Produit 10",origin:"ðŸ‡ºðŸ‡¸",price:18},
  {id:"P11",name:"Cali Canadienne",origin:"ðŸ‡¨ðŸ‡¦",price:12},
];

/* ==============================
   STATE
   ============================== */
let state = {
  cart: loadCart(),
  query:"",
  weightSelection: {} // id -> grammes
};

/* ==============================
   HELPERS
   ============================== */
function loadCart(){
  try{
    const c=JSON.parse(localStorage.getItem('mini_cart'));
    return c&&typeof c==='object'?c:{};
  }catch(e){return {};}
}
function saveCart(){
  localStorage.setItem('mini_cart',JSON.stringify(state.cart));
}
function money(n){return Number(n||0).toFixed(2)+' â‚¬';}

/* ==============================
   RENDER CATALOGUE
   ============================== */
const catalogueEl = document.getElementById('catalogue');
function renderCatalogue(){
  const q = state.query.toLowerCase();
  catalogueEl.innerHTML = '';
  const filtered = PRODUCTS.filter(p=>p.name.toLowerCase().includes(q)||p.origin.toLowerCase().includes(q));
  if(filtered.length===0){
    catalogueEl.innerHTML='<div class="text-muted text-center">Aucun produit trouvÃ©.</div>';
    return;
  }
  filtered.forEach(p=>{
    const qty = state.cart[p.id]?.qty||0;
    const weight = state.weightSelection[p.id] || 1;
    const card = document.createElement('div');
    card.className='bg-bg1 border border-white/10 rounded-xl3 p-4 flex flex-col gap-3';
    card.innerHTML=`
      <div class="flex justify-between items-center">
        <div>
          <div class="font-black text-lg">${p.name}</div>
          <div class="text-sm text-muted">${p.origin}</div>
        </div>
        <div class="text-sm font-black">${money((p.price/1)*weight)} / ${weight}g</div>
      </div>
      <input type="range" min="1" max="100" value="${weight}" data-id="${p.id}" class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider-thumb">
      <div class="flex justify-between items-center">
        <button data-act="add" data-id="${p.id}" class="px-3 py-2 rounded-xl2 border border-white/10 bg-accent text-black font-black flex-1 mr-2">
          Ajouter au panier
        </button>
        <span class="font-black text-text">${qty} pcs</span>
      </div>
    `;
    catalogueEl.appendChild(card);
  });
}

/* ==============================
   HANDLE ACTIONS
   ============================== */
catalogueEl.addEventListener('click',e=>{
  const btn=e.target.closest('button');
  if(btn){
    const act = btn.dataset.act;
    const id = btn.dataset.id;
    if(act==='add' && id){
      const weight = state.weightSelection[id] || 1;
      const current = state.cart[id]?.qty || 0;
      const totalPrice = (state.cart[id]?.price || 0) + (PRODUCTS.find(p=>p.id===id).price * weight /1);
      state.cart[id] = { qty: current + 1, price: totalPrice };
      saveCart();
      renderCatalogue();
      renderCart();
    }
  }
});

catalogueEl.addEventListener('input', e=>{
  if(e.target.type==='range'){
    const id = e.target.dataset.id;
    state.weightSelection[id] = parseInt(e.target.value);
    renderCatalogue();
  }
});

/* ==============================
   SEARCH
   ============================== */
document.getElementById('search').addEventListener('input', e=>{
  state.query=e.target.value;
  renderCatalogue();
});

/* ==============================
   RENDER CART
   ============================== */
const cartItemsEl = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');

function renderCart(){
  cartItemsEl.innerHTML='';
  const items = Object.entries(state.cart);
  if(items.length===0){
    cartItemsEl.innerHTML='<div class="text-muted text-center mt-4">Panier vide</div>';
    cartTotalEl.textContent='0 â‚¬';
    return;
  }
  let total=0;
  items.forEach(([id,data])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(p){
      total+=data.price;
      const line = document.createElement('div');
      line.className='flex justify-between items-center border-b border-white/10 pb-2';
      line.innerHTML=`
        <div>
          <div class="font-black">${p.name} Ã—${data.qty}</div>
          <div class="text-sm text-muted">${data.price.toFixed(2)} â‚¬</div>
        </div>
        <button data-id="${id}" class="text-red-500 font-black">âœ•</button>
      `;
      cartItemsEl.appendChild(line);
    }
  });
  cartTotalEl.textContent = money(total);
}

/* ==============================
   REMOVE ITEM CART
   ============================== */
cartItemsEl.addEventListener('click', e=>{
  const btn = e.target.closest('button');
  if(btn){
    const id = btn.dataset.id;
    if(id){
      delete state.cart[id];
      saveCart();
      renderCart();
      renderCatalogue();
    }
  }
});

/* ==============================
   OPEN/CLOSE DRAWER
   ============================== */
document.getElementById('openCart').addEventListener('click',()=>{
  document.getElementById('cartDrawer').style.right='0';
});
document.getElementById('closeCart').addEventListener('click',()=>{
  document.getElementById('cartDrawer').style.right='-100%';
});

/* ==============================
   CLEAR / COPY CART
   ============================== */
document.getElementById('clearCart').addEventListener('click',()=>{
  state.cart={};
  saveCart();
  renderCart();
  renderCatalogue();
});
document.getElementById('copyCart').addEventListener('click',()=>{
  let text = '';
  Object.entries(state.cart).forEach(([id,data])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(p) text+=`${p.name} Ã—${data.qty} = ${data.price.toFixed(2)} â‚¬\n`;
  });
  if(!text) text='Panier vide';
  navigator.clipboard.writeText(text).then(()=>alert('Panier copiÃ© !'));
});

/* ==============================
   INITIALIZE
   ============================== */
renderCatalogue();
renderCart();
</script>

<style>
/* CUSTOM SLIDER */
input[type=range].slider-thumb::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #FFD400;
  cursor: pointer;
  border: none;
  box-shadow: 0 0 2px rgba(0,0,0,0.5);
}
input[type=range].slider-thumb::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #FFD400;
  cursor: pointer;
  border: none;
  box-shadow: 0 0 2px rgba(0,0,0,0.5);
}
input[type=range]::-webkit-slider-runnable-track {
  height: 6px;
  border-radius: 3px;
  background: rgba(255,255,255,0.2);
}
input[type=range]::-moz-range-track {
  height: 6px;
  border-radius: 3px;
  background: rgba(255,255,255,0.2);
}
</style>

</body>
</html>
