<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="dark">
<title>GRAM STORE â€” Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config={
darkMode:'class',
theme:{extend:{
colors:{
bg0:'#05070D',bg1:'#0B1020',
glass:'rgba(255,255,255,.06)',
stroke:'rgba(255,255,255,.12)',
text:'rgba(250,253,255,.96)',
muted:'rgba(250,253,255,.65)',
accent:'#FFD400',accent2:'#FFB800',
good:'#2EE59D',bad:'#FF4D4D'
},
borderRadius:{xl2:'18px',xl3:'24px',xl4:'28px'}
}}}
</script>
</head>

<body class="min-h-screen font-sans text-text bg-[linear-gradient(180deg,#05070D,#0B1020)]">

<div class="mx-auto max-w-[980px] px-3 pb-[120px] pt-[calc(14px+env(safe-area-inset-top))]">

<!-- HEADER -->
<header class="sticky top-0 z-20 mb-3 border-b border-white/10 bg-[#05070D]/80 backdrop-blur">
  <div class="flex items-center justify-between py-3">
    <div>
      <h1 class="text-[18px] font-black">GRAM STORE</h1>
      <p class="text-[12px] text-muted">Commande au gramme â€¢ Envoi privÃ©</p>
    </div>
    <div class="flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5">
      <span class="h-2 w-2 rounded-full bg-good"></span>
      <span class="text-[12px]">OUVERT</span>
    </div>
  </div>

  <input id="q"
    class="w-full rounded-xl3 bg-white/5 border border-white/10 px-4 py-3 text-[14px] outline-none"
    placeholder="Recherche : nom ou provenance">
</header>

<!-- LIST -->
<main>
  <div class="mb-2 flex items-center justify-between">
    <span class="text-[13px] font-black">Catalogue</span>
    <span id="count" class="text-[12px] text-muted">â€”</span>
  </div>

  <div id="list" class="flex flex-col gap-3"></div>

  <div id="empty" class="hidden mt-4 rounded-xl3 border border-dashed border-white/15 bg-white/5 p-4 text-center text-muted">
    Aucun produit trouvÃ©
  </div>
</main>
</div>

<!-- CART BAR -->
<div class="fixed bottom-0 left-0 right-0 z-40 border-t border-white/10 bg-[#05070D]/90 backdrop-blur px-3 py-3">
  <div class="mx-auto max-w-[980px] flex items-center gap-3">
    <button id="openCart"
      class="flex-1 flex items-center justify-between rounded-xl3 border border-white/10 bg-white/5 px-4 py-3">
      <div>
        <div class="font-black text-[13px]">ðŸ§º Panier</div>
        <div id="cartHint" class="text-[12px] text-muted">Vide</div>
      </div>
      <div id="badge"
        class="grid h-8 min-w-[32px] place-items-center rounded-full bg-[rgba(255,212,0,.18)] text-[13px] font-black">
        0
      </div>
    </button>
  </div>
</div>

<!-- SHEET -->
<div id="mask" class="fixed inset-0 bg-black/60 opacity-0 pointer-events-none transition"></div>

<aside id="sheet"
class="fixed left-1/2 z-50 w-[min(980px,calc(100%-16px))] -translate-x-1/2 rounded-xl4 border border-white/10 bg-[#0B1020] shadow-xl transition-[bottom] duration-300"
style="bottom:-120%">
  
  <div class="border-b border-white/10 px-4 py-3 flex justify-between">
    <span class="font-black">Panier</span>
    <button id="closeCart">Fermer</button>
  </div>

  <div class="max-h-[60vh] overflow-auto px-4 py-3">
    <div id="cartItems"></div>
    <div id="cartEmpty" class="hidden text-center text-muted py-6">
      Panier vide
    </div>

    <div class="mt-4 rounded-xl3 border border-white/10 bg-white/5 p-3">
      <label class="text-[12px] text-muted">Ton nom</label>
      <input id="name" class="w-full mt-1 rounded-xl2 bg-black/20 px-3 py-2 outline-none">

      <label class="mt-3 block text-[12px] text-muted">TÃ©lÃ©phone</label>
      <input id="phone" class="w-full mt-1 rounded-xl2 bg-black/20 px-3 py-2 outline-none">
    </div>
  </div>

  <div class="border-t border-white/10 px-4 py-3">
    <div class="flex justify-between text-[14px]">
      <span>Total indicatif</span>
      <b id="total">0.00 â‚¬</b>
    </div>
    <button id="order"
      class="mt-3 w-full rounded-xl3 bg-gradient-to-br from-accent to-accent2 py-3 font-black text-[#141414]">
      Commander via Telegram
    </button>
  </div>
</aside>

<script>
/* ================= DATA ================= */
const PRODUCTS=[
{id:"G01",name:"Static Dry",origin:"ðŸ‡²ðŸ‡¦ Maroc",price:10},
{id:"G02",name:"Frozen Trim",origin:"ðŸ‡³ðŸ‡± Pays-Bas",price:8},
{id:"G03",name:"Premium Cali",origin:"ðŸ‡ºðŸ‡¸ USA",price:18},
{id:"G04",name:"Hash Mousseux",origin:"ðŸ‡²ðŸ‡¦ Maroc",price:6}
];

const CONTACT="Petter59000XSLR";
const CART_KEY="gram_cart_v1";

/* ================= STATE ================= */
const state={
q:"",
cart:JSON.parse(localStorage.getItem(CART_KEY)||"{}")
};

/* ================= HELPERS ================= */
const $=id=>document.getElementById(id);
const money=n=>Number(n).toFixed(2)+" â‚¬";

function cartItems(){
return Object.entries(state.cart).map(([id,g])=>{
const p=PRODUCTS.find(x=>x.id===id);
return p?{p,grams:g}:null;
}).filter(Boolean);
}

function total(){
return cartItems().reduce((s,i)=>s+i.grams*i.p.price,0);
}

function save(){
localStorage.setItem(CART_KEY,JSON.stringify(state.cart));
renderAll();
}

/* ================= RENDER ================= */
function renderList(){
const q=state.q.toLowerCase();
const list=$("list");
list.innerHTML="";
const filtered=PRODUCTS.filter(p=>
(p.name+p.origin).toLowerCase().includes(q)
);

$("count").textContent=filtered.length+" produit(s)";
$("empty").classList.toggle("hidden",filtered.length>0);

for(const p of filtered){
const g=state.cart[p.id]||0;
const el=document.createElement("div");
el.className="rounded-xl4 border border-white/10 bg-white/5 p-4";
el.innerHTML=`
<div class="flex justify-between">
  <div>
    <div class="font-black">${p.name}</div>
    <div class="text-[12px] text-muted">${p.origin}</div>
  </div>
  <div class="text-right">
    <div class="font-black">${p.price} â‚¬ / g</div>
    <div class="text-[12px] text-muted">${g} g</div>
  </div>
</div>

<div class="mt-3 flex gap-2">
  <input type="number" min="0" step="1" value="${g}"
    class="flex-1 rounded-xl2 bg-black/20 px-3 py-2"
    data-id="${p.id}">
  <button class="add rounded-xl2 bg-white/10 px-4"
    data-id="${p.id}">OK</button>
</div>`;
el.querySelector(".add").onclick=()=>{
const val=parseInt(el.querySelector("input").value||0);
if(val<=0) delete state.cart[p.id];
else state.cart[p.id]=val;
save();
};
list.appendChild(el);
}
}

function renderCart(){
const items=cartItems();
$("cartItems").innerHTML="";
$("cartEmpty").classList.toggle("hidden",items.length>0);
for(const it of items){
const row=document.createElement("div");
row.className="mb-2 flex justify-between text-[13px]";
row.innerHTML=`
<span>${it.p.name} (${it.grams} g)</span>
<b>${money(it.grams*it.p.price)}</b>`;
$("cartItems").appendChild(row);
}
$("total").textContent=money(total());
$("cartHint").textContent=items.length?items.length+" produit(s)":"Vide";
$("badge").textContent=items.length;
}

/* ================= ORDER ================= */
function order(){
if(!cartItems().length) return;
let msg="ðŸ§¾ COMMANDE\n\n";
for(const it of cartItems()){
msg+=`â€¢ ${it.p.name} ${it.grams}g (${it.p.origin}) = ${money(it.grams*it.p.price)}\n`;
}
msg+=`\nTotal: ${money(total())}\n`;
msg+=`Nom: ${$("name").value}\nTel: ${$("phone").value}`;
window.open(`https://t.me/${CONTACT}?text=${encodeURIComponent(msg)}`);
}

/* ================= EVENTS ================= */
$("q").oninput=e=>{state.q=e.target.value;renderList();};
$("openCart").onclick=()=>{
$("mask").classList.remove("opacity-0","pointer-events-none");
$("sheet").style.bottom="10px";
renderCart();
};
$("closeCart").onclick=closeCart;
$("mask").onclick=closeCart;
function closeCart(){
$("mask").classList.add("opacity-0","pointer-events-none");
$("sheet").style.bottom="-120%";
}
$("order").onclick=order;

/* ================= INIT ================= */
function renderAll(){renderList();renderCart();}
renderAll();
</script>
</body>
</html>
